<h1>List of Users</h1>

<table border="1">
  <tr>
    <th>Username</th>
    <th>Private?</th>
    <th></th>
    <th></th>
  </tr>

  <% @list_of_users.each do |a_user| %>
    <tr>
      <td>
        <%= a_user.username %>
      </td>

      <td>
        <% if a_user.private == true %>
          Yes
        <% else %>
          No 
        <% end %>
      </td>

      <td>
        <% if session.fetch(:user_id) != nil %>
          <% a = FollowRequest.where({ :recipient_id => a_user.id, :sender_id => @current_user.id , status: "pending" }) %>
          <% the_following_request = a.at(0) %>

          <% b = FollowRequest.where({ :recipient_id => a_user.id, :sender_id => @current_user.id , status: "accepted" }) %>
          <% the_following_request_accepted = b.at(0) %>
        
          <% if the_following_request != nil %> 
            Request sent. <a href="/delete_follow_request/<%= the_following_request.id %>">Cancel</a>

          <% elsif the_following_request == nil && a_user.private == true %>

            <form action="/insert_follow_request" method="post">
              <input type="hidden" name="query_recipient_id" value="<%= a_user.id %>">
              <input type="hidden" name="query_sender_id" value="<%= @current_user.id %>">
              
             
              <button>Follow2</button>
            </form>
          <% elsif the_following_request_accepted == nil && a_user.private == false %>
           <form action="/insert_follow_request" method="post">
              <input type="hidden" name="query_recipient_id" value="<%= a_user.id %>">
              <input type="hidden" name="query_sender_id" value="<%= @current_user.id %>">
              <button>Follow3</button>
            </form>
          
          <% elsif the_following_request_accepted != nil %>
            <a href="/delete_follow_request/<%= the_following_request_accepted.id %>">Unfollow</a>

          <% end %>

        <% end %>
      </td>

      <td>
        <a href="/users/<%= a_user.username %>">Show details</a>
      </td>
    </tr>
  <% end %>
</table>
